!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("core-js/fn/array/find"),require("core-js/fn/object/assign"),require("clone"),require("d3-ease"),require("d3-hierarchy"),require("prop-types"),require("react")):"function"==typeof define&&define.amd?define(["core-js/fn/array/find","core-js/fn/object/assign","clone","d3-ease","d3-hierarchy","prop-types","react"],r):(e=e||self).ReactTreeGraph=r(0,0,e.clone,e.d3,e.d3,e.PropTypes,e.React)}(this,function(e,r,p,t,a,s,u){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function o(e,r){for(var t=0;t<r.length;t++){var s=r[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function i(e,r,t){return r&&o(e.prototype,r),t&&o(e,t),e}function c(){return(c=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e}).apply(this,arguments)}function l(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,s)}return t}function d(o){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach(function(e){var r,t,s;r=o,s=n[t=e],t in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))})}return o}function h(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&y(e,r)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,r){return(y=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,r){return!r||"object"!=typeof r&&"function"!=typeof r?b(e):r}function m(e){return function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var g=/on[A-Z]/;function k(o){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var t=Object.keys(o).filter(function(e){return g.test(e)&&"function"==typeof o[e]}).reduce(function(e,r){var t,s;return e[r]=(t=o[r],s=n,function(e){return t.apply(void 0,[e].concat(m(s)))}),e},{});return d({},o,{},t)}var R={source:s.object.isRequired,target:s.object.isRequired,keyProp:s.string.isRequired,x1:s.number.isRequired,x2:s.number.isRequired,y1:s.number.isRequired,y2:s.number.isRequired,pathFunc:s.func.isRequired,pathProps:s.object.isRequired};var q={pathFunc:function(e,r,t,s){return"M".concat(r,",").concat(e,"C").concat((r+s)/2,",").concat(e," ").concat((r+s)/2,",").concat(t," ").concat(s,",").concat(t)}},v=function(){function e(){return n(this,e),P(this,f(e).apply(this,arguments))}return h(e,u.PureComponent),i(e,[{key:"render",value:function(){var e=k(this.props.pathProps,this.props.source.data[this.props.keyProp],this.props.target.data[this.props.keyProp]),r=this.props.pathFunc(this.props.x1,this.props.y1,this.props.x2,this.props.y2);return u.createElement("path",c({},e,{d:r}))}}]),e}();v.defaultProps=q,v.propTypes=R;var j={id:s.any.isRequired,onCollapseClick:s.func.isRequired},C=function(){function t(e){var r;return n(this,t),(r=P(this,f(t).call(this,e))).onClick=r.onClick.bind(b(r)),r}return h(t,u.PureComponent),i(t,[{key:"onClick",value:function(e){e.stopPropagation(),this.props.onCollapseClick(e,this.props.id)}},{key:"render",value:function(){return u.createElement("g",{onClick:this.onClick},u.createElement("circle",{cx:"70",r:"13",stroke:"#4e5d6c",fillOpacity:"0"}),u.createElement("path",{d:"M 65 0 H 75",stroke:"#fff",strokeWidth:"2px"}),this.props.collapsed&&u.createElement("path",{d:"M 70 5 V -5",stroke:"#fff",strokeWidth:"2px"}))}}]),t}();C.propTypes=j;var x={x:s.number.isRequired,y:s.number.isRequired,keyProp:s.string.isRequired,labelProp:s.string.isRequired,offset:s.number.isRequired,radius:s.number.isRequired,circleProps:s.object.isRequired,gProps:s.object.isRequired,textProps:s.object.isRequired,rect:s.bool.isRequired,rectProps:s.object.isRequired,collapsible:s.bool.isRequired},w=function(){function e(){return n(this,e),P(this,f(e).apply(this,arguments))}return h(e,u.PureComponent),i(e,[{key:"getTransform",value:function(){return"translate(".concat(this.props.y,", ").concat(this.props.x,")")}},{key:"render",value:function(){var e=k(this.props.circleProps,this.props[this.props.keyProp]),r=k(this.props.rectProps,this.props[this.props.keyProp]),t=k(this.props.gProps,this.props[this.props.keyProp]),s=k(this.props.textProps,this.props[this.props.keyProp]),o=this.props.collapsible&&(this.props.children||this.props.collapsed);return u.createElement("g",c({},t,{transform:this.getTransform()}),this.props.rect?u.createElement("rect",r):u.createElement("circle",c({},e,{r:this.props.radius})),o&&u.createElement(C,{id:this.props[this.props.keyProp],onCollapseClick:this.props.onCollapseClick,collapsed:this.props.collapsed}),u.createElement("text",c({dx:this.props.radius+.5,dy:this.props.offset},s),this.props[this.props.labelProp]))}}]),e}();w.propTypes=x;var O={children:s.node,height:s.number.isRequired,keyProp:s.string.isRequired,labelProp:s.string.isRequired,links:s.array.isRequired,nodes:s.array.isRequired,nodeClassName:s.string,nodeOffset:s.number.isRequired,nodeRadius:s.number.isRequired,pathFunc:s.func,width:s.number.isRequired,circleProps:s.object.isRequired,gProps:s.object.isRequired,pathProps:s.object.isRequired,svgProps:s.object.isRequired,textProps:s.object.isRequired,rect:s.bool.isRequired,rectProps:s.object.isRequired,collapsible:s.bool.isRequired,onCollapseClick:s.func.isRequired},E=function(){function e(){return n(this,e),P(this,f(e).apply(this,arguments))}return h(e,u.PureComponent),i(e,[{key:"render",value:function(){var r=this,e=this.props.links.sort(function(e,r){return e.target.data.pathProps&&r.target.data.pathProps?0:e.target.data.pathProps?1:r.target.data.pathProps?-1:void 0});return u.createElement("svg",c({},this.props.svgProps,{height:this.props.height,width:this.props.width}),this.props.children,e.map(function(e){return u.createElement(v,{key:e.target.data[r.props.keyProp],keyProp:r.props.keyProp,pathFunc:r.props.pathFunc,source:e.source,target:e.target,x1:e.source.x,x2:e.target.x,y1:e.source.y,y2:e.target.y,pathProps:d({},r.props.pathProps,{},e.target.data.pathProps)})}),this.props.nodes.map(function(e){return u.createElement(w,c({key:e.data[r.props.keyProp],keyProp:r.props.keyProp,labelProp:r.props.labelProp,offset:r.props.nodeOffset,radius:r.props.nodeRadius,x:e.x,y:e.y,rect:r.props.rect},e.data,{circleProps:d({},r.props.circleProps,{},e.data.circleProps),gProps:d({},r.props.gProps,{},e.data.gProps),textProps:d({},r.props.textProps,{},e.data.textProps),rectProps:d({},r.props.rectProps,{},e.data.rectProps),collapsible:r.props.collapsible,onCollapseClick:r.props.onCollapseClick}))}))}}]),e}();E.propTypes=O;var S={animated:s.bool.isRequired,getChildren:s.func.isRequired,keyProp:s.string.isRequired,links:s.array.isRequired,nodes:s.array.isRequired,duration:s.number.isRequired,easing:s.func.isRequired,steps:s.number.isRequired},N=function(){function o(e){var r;if(n(this,o),r=P(this,f(o).call(this,e)),e.animated){var t=e.nodes[0].x,s=e.nodes[0].y;r.state={nodes:e.nodes.map(function(e){return d({},e,{x:t,y:s})}),links:e.links.map(function(e){return{source:d({},e.source,{x:t,y:s}),target:d({},e.target,{x:t,y:s})}})}}else r.state={nodes:e.nodes,links:e.links};return r}return h(o,u.PureComponent),i(o,[{key:"componentDidMount",value:function(){this.props.animated&&this.animate(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.nodes===this.props.nodes&&e.links===this.props.links||(e.animated?this.animate(e):this.setState({nodes:e.nodes,links:e.links}))}},{key:"animate",value:function(e){var r=this;clearInterval(this.animation);var t=0,s=this.getAnimationContext(this.state,e);this.animation=setInterval(function(){if(++t===e.steps)return clearInterval(r.animation),r.animation=null,void r.setState({nodes:e.nodes,links:e.links});r.setState(r.calculateNewState(s,t/e.steps))},e.duration/e.steps)}},{key:"getAnimationContext",value:function(t,s){var o=this,e=s.nodes.filter(function(r){return t.nodes.every(function(e){return!o.areNodesSame(r,e)})}).map(function(e){return{base:e,old:o.getClosestAncestor(e,s,t),new:e}}),r=s.nodes.filter(function(r){return t.nodes.some(function(e){return o.areNodesSame(r,e)})}).map(function(r){return{base:r,old:t.nodes.find(function(e){return o.areNodesSame(r,e)}),new:r}}),n=t.nodes.filter(function(r){return s.nodes.every(function(e){return!o.areNodesSame(r,e)})}).map(function(e){return{base:e,old:e,new:o.getClosestAncestor(e,t,s)}}),i=s.links.filter(function(r){return t.links.every(function(e){return!o.areLinksSame(r,e)})}).map(function(e){return{base:e,old:o.getClosestAncestor(e.target,s,t),new:e}}),p=s.links.filter(function(r){return t.links.some(function(e){return o.areLinksSame(r,e)})}).map(function(r){return{base:r,old:t.links.find(function(e){return o.areLinksSame(r,e)}),new:r}}),a=t.links.filter(function(r){return s.links.every(function(e){return!o.areLinksSame(r,e)})}).map(function(e){return{base:e,old:e,new:o.getClosestAncestor(e.target,t,s)}});return{nodes:r.concat(e).concat(n),links:p.concat(i).concat(a)}}},{key:"getClosestAncestor",value:function(e,r,t){for(var s=this,o=e;o;){var n=t.nodes.find(function(e){return s.areNodesSame(o,e)});if(n)return n;o=r.nodes.find(function(e){return(s.props.getChildren(e)||[]).some(function(e){return s.areNodesSame(o,e)})})}return t.nodes[0]}},{key:"areNodesSame",value:function(e,r){return e.data[this.props.keyProp]===r.data[this.props.keyProp]}},{key:"areLinksSame",value:function(e,r){return e.source.data[this.props.keyProp]===r.source.data[this.props.keyProp]&&e.target.data[this.props.keyProp]===r.target.data[this.props.keyProp]}},{key:"calculateNewState",value:function(e,r){var t=this;return{nodes:e.nodes.map(function(e){return t.calculateNodePosition(e.base,e.old,e.new,r)}),links:e.links.map(function(e){return t.calculateLinkPosition(e.base,e.old,e.new,r)})}}},{key:"calculateNodePosition",value:function(e,r,t,s){return d({},e,{x:this.calculateNewValue(r.x,t.x,s),y:this.calculateNewValue(r.y,t.y,s)})}},{key:"calculateLinkPosition",value:function(e,r,t,s){return{source:d({},e.source,{x:this.calculateNewValue(r.source?r.source.x:r.x,t.source?t.source.x:t.x,s),y:this.calculateNewValue(r.source?r.source.y:r.y,t.source?t.source.y:t.y,s)}),target:d({},e.target,{x:this.calculateNewValue(r.target?r.target.x:r.x,t.target?t.target.x:t.x,s),y:this.calculateNewValue(r.target?r.target.y:r.y,t.target?t.target.y:t.y,s)})}}},{key:"calculateNewValue",value:function(e,r,t){return e+(r-e)*this.props.easing(t)}},{key:"render",value:function(){return u.createElement(E,c({},this.props,this.state))}}]),o}();N.propTypes=S;var A={data:s.object.isRequired,animated:s.bool.isRequired,children:s.node,duration:s.number.isRequired,easing:s.func.isRequired,steps:s.number.isRequired,height:s.number.isRequired,width:s.number.isRequired,keyProp:s.string.isRequired,labelProp:s.string.isRequired,getChildren:s.func.isRequired,margins:s.shape({bottom:s.number.isRequired,left:s.number.isRequired,right:s.number.isRequired,top:s.number.isRequired}).isRequired,pathFunc:s.func,nodeOffset:s.number.isRequired,nodeRadius:s.number.isRequired,circleProps:s.object.isRequired,gProps:s.object.isRequired,pathProps:s.object.isRequired,svgProps:s.object.isRequired,textProps:s.object.isRequired,rect:s.bool.isRequired,rectProps:s.object.isRequired,collapsible:s.bool.isRequired,onCollapseClick:s.func.isRequired},T={animated:!1,duration:500,easing:t.easeQuadOut,getChildren:function(e){return e.children},steps:20,keyProp:"name",labelProp:"name",margins:{bottom:10,left:20,right:150,top:10},nodeOffset:3.5,nodeRadius:5,circleProps:{},gProps:{},pathProps:{},svgProps:{},textProps:{},rect:!1,rectProps:{},collapsible:!1,onCollapseClick:function(){}},F=function(){function e(){return n(this,e),P(this,f(e).apply(this,arguments))}return h(e,u.PureComponent),i(e,[{key:"render",value:function(){var r=this,e=this.props.width-this.props.margins.left-this.props.margins.right,t=this.props.height-this.props.margins.top-this.props.margins.bottom,s=a.hierarchy(p(this.props.data),this.props.getChildren),o=a.tree().size([t,e])(s),n=o.descendants(),i=o.links();return n.forEach(function(e){e.y+=r.props.margins.top}),u.createElement(N,{animated:this.props.animated,duration:this.props.duration,easing:this.props.easing,getChildren:this.props.getChildren,height:this.props.height,keyProp:this.props.keyProp,labelProp:this.props.labelProp,links:i,nodes:n,nodeOffset:this.props.nodeOffset,nodeRadius:this.props.nodeRadius,pathFunc:this.props.pathFunc,steps:this.props.steps,width:this.props.width,circleProps:this.props.circleProps,gProps:d({className:"node"},this.props.gProps),pathProps:d({className:"link"},this.props.pathProps),svgProps:this.props.svgProps,textProps:this.props.textProps,rect:this.props.rect,rectProps:this.props.rectProps,collapsible:this.props.collapsible,onCollapseClick:this.props.onCollapseClick},this.props.children)}}]),e}();return F.propTypes=A,F.defaultProps=T,F});
